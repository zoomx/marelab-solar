<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<!--  JQUERY CSS -->
<link rel="stylesheet"
	href="script/jquery/themes/dark-hive/jquery-ui.css" />


<!--  Marelab CSS -->
<link rel="stylesheet" href="css/marelab.css" />

<style>
.ui-progressbar .ui-progressbar-value {
	background-image: url(images/pbar-ani.gif);
}
</style>


<link href="favicon.ico" rel="shortcut icon"
	type="image/vnd.microsoft.icon" />

<style type="text/css">
.PluginButton {
	background-color: #114a69;
	-moz-border-radius: 9px;
	-webkit-border-radius: 9px;
	border-radius: 9px;
	display: inline-block;
	color: #ffffff;
	font-family: Arial;
	font-size: 15px;
	font-weight: bold;
	padding: 5px 10px;
	width: 120px;
	text-decoration: none;
}
/* This imageless css button was generated by CSSButtonGenerator.com */
</style>

<!--  JQUERY INCLUDE -->
<script src="script/jquery/jquery-1.8.2.js"></script>
<script src="script/jquery/ui/jquery-ui.js"></script>

<!-- Language includes -->
<script src="script/marelab/marelab_lan_EN.js"></script>



<script>

	
	var content_container;
	var content_plugin;
	var content_main_menu;
	
	// mcu plugin config object
	
	var PluginLogicObjectList = [];
	var MARELAB_CONFIG_LIST =[];
	
	var ConTypeEnum = Object.freeze({IO: 0, DA: 1, AD: 2});
	var ConDirEnum  = Object.freeze({IN: 0, OUT: 1, BI: 2});
	
	$(function() {
    	$("#BUTTONLOG").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: true } );
        $("#BUTTON_SCAN_PLUGIN").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: true } );
        $("#BUTTON").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: false } );
        $("#BUTTON_SCAN_MBD").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: true } );
        $("#BUTTONLOG").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: true } );
        $("#SAVEPORT").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: true } );
        $("#PORTSCAN").button( {icons: {primary: "ui-icon-refresh ui-icon-refresh-1-n"}, text: true } );
        $("#accordion" ).accordion({ heightStyle: "fill" });
    });
	
	
	function loadjscssfile(filename, filetype) {
		if (filetype == "js") { //if filename is a external JavaScript file
			var fileref = document.createElement('script')
			fileref.setAttribute("type", "text/javascript")
			fileref.setAttribute("src", filename)
		} else if (filetype == "css") { //if filename is an external CSS file
			var fileref = document.createElement("link")
			fileref.setAttribute("rel", "stylesheet")
			fileref.setAttribute("type", "text/css")
			fileref.setAttribute("href", filename)
		}
		if (typeof fileref != "undefined")
			document.getElementsByTagName("head")[0].appendChild(fileref)
	}
	
	// Gets executed first call of document
	$(document).ready(function() {
		// load all Plugin Scripts
		LoadPluginScripts();
    	// Get Deamon Info	
		mCU_PORTSCAN();
		mcu_BUSRESTORE();
		
		// Build Logic & Adapter Plugin Table
		MarelabVersion();
		
		
		CreatePluginMenu();
		
		generateLogicPlugin();
		
		// START OF CLOCK
		startTime();
		

		GenerateLogic2PhysicTable("LedDimmer","TestList");
	});
	
	$(document).ready(function(){
	    
		var p=0;
	    
		// SAVES the CONTENT OF THE FIRST PAGE
		content_container = $("#tabs-1").html();
		content_main_menu = $("#main_menu").html();
		
		$("#myDialog").dialog({
	        height: 100,
	        width:500,
	        autoOpen:true
	    });
	    
	    $("#myProgressBar").progressbar({
	    	value:0,
	    width:500
	    	
	    });
	        var timer = setInterval(function(){
	            //This animates the bar
	            $("#myProgressBar .ui-progressbar-value").animate({width: p+"%"}, 500);
	            //This does static sets of the value
	            //$("#myProgressBar").progressbar("option","value",p);
	            p = p +3;
	            if(p>100){
	                $("#myProgressBar .ui-progressbar-value").animate({width: "100%"}, 500);
	                //$("#myProgressBar").progressbar("option","value",100);
	                clearInterval(timer);
	            }
	    },500);
	        
	    // ******************************************************************    
	    // Change Handler for the changed drop select Box for Adapter Chips
	    // ******************************************************************
	    $("#TestList").change(function(eventObject){ 
	    	//$('#dropDownId').val();
	    	//To get the currently selected text:
	    	//$('#dropDownId :selected').text();
	    	//alert(eventObject.SrcElement);
	    	alert( "Handler for .change() called:" + 
	    			"TEXT CHIP_DROP_DOWN   :" + $("select#CHIP_DROP_DOWN0.PLUGINDROPDOWNSTYLE :selected").val()+ "\r\n"+
	    			"TEXT ADRESS_DROP_DOWN :" + $("select#ADRESS_DROP_DOWN0.PLUGINDROPDOWNSTYLE :selected").val()+ "\r\n"+
					"TEXT PORT_DROP_DOWN   :" + $("select#PORT_DROP_DOWN0.PLUGINDROPDOWNSTYLE :selected").val()+ "\r\n"	
	    	);});
	    	//alert( "Handler for .change() called by " + $(eventObject.target +" :selected").text());});    
	}
	);
	
	
	

	
	
	// Add a mBD Device Row
	// <div id="listOfPlugins">
	function addPluginList_HTML(name,version){
		var html = '<table width="400px" border="0" cellspacing="4" cellpadding = "4">';
		html = html + '	<tr >';
		html = html + '		<th width="100px align="left" id="MDB-mCU-content1">';
		html = html + version;
		html = html + '		</th>';
		html = html + '		<th align="left" id="MDB-mCU-content2">';
		html = html + '			' + name ;
		html = html + '		</th>';
		html = html + '	</tr> ';
		html = html + '</table>';
		return html;
	}
	
	// RESTORE THE SETTINGS THE PORT
	function mcu_BUSRESTORE(){
		var plugin_info;
	    jsonRET = getMarelabData('COMMAND=mcu_BUSRESTORE');
	    //alert(jsonRET.PARAMETER.BUS[0].BUS.BAUD);
	    //$("#mCU_BAUD").selectOptions();
	    
	    // REWORK OF HARDWARE PLUGS
	    //$("#mCU_PORT").val( jsonRET.PARAMETER.BUS[0].BUS.PORT ).prop('selected',true);
	    //$("#mCU_BAUD").val( jsonRET.PARAMETER.BUS[0].BUS.BAUD ).prop('selected',true);
	    
	    // Restore the mBD on the Bus the list is done by the readed devices in the confighm
	    //for (x in jsonRET.PARAMETER.MBD) {
	    //	adress = jsonRET.PARAMETER.MBD[x].MBD.ADRESSE;
	    //	major  = jsonRET.PARAMETER.MBD[x].MBD.VERSIOMAJOR;
	    //	minjor = jsonRET.PARAMETER.MBD[x].MBD.VERSIOMINOR;
	    //	name   = jsonRET.PARAMETER.MBD[x].MBD.NAME.toString();
	    //	uuid   = jsonRET.PARAMETER.MBD[x].MBD.UUID.toString();	
	    //	$("table#MDB-TABLE-LIST").append(addMBD_HTML(x,adress,major,minjor,name,uuid));
		//}
	}
	
	function MarelabVersion(){
		var plugin_info;
	    jsonRET = getMarelabData('COMMAND=mcu_VERSION');
		$("p#deamonVersion").html("Version:" + jsonRET.PARAMETER);
		$("spam#deamonVersion").html(jsonRET.PARAMETER);
	}
	
	
	
	function getMarelabData(what2Get) {
		var dataret;
		$.ajax({
			type : "POST",
			//url: 'cgi.php',
			url : 'cgi/marelab-cgi',
			data : what2Get,
			async : false,
			beforeSend : function(x) {
				if (x && x.overrideMimeType) {
					x.overrideMimeType("application/j-son;charset=UTF-8");
				}
			},
			dataType : "json",
			success : function(data) {
				dataret = data;
				if (data.ERROR) {
					// ERROR HAS HAPPEND 
					alert(data.ERROR);
				}
			}
		});
		return dataret;
	}

	// Load javascripts that belongs to the plugins that are installed 
	function LoadPluginScripts() {
		// get the list of javascript files form the plugin regestry
		// the names are just generated by the pluginname +".js" 
		var what2Get = getMarelabData('COMMAND=PLUGIN_JAVASCRIPTFILES');
		//getMarelabData(what2Get);
		for (x in what2Get.PARAMETER) {
			
			scriptname = what2Get.PARAMETER[x].PLUGINNAME + ".css";
			scriptname = "/plugins/" + scriptname;
			loadjscssfile(scriptname, "css"); //dynamically load and add this .js file
			
			scriptname = what2Get.PARAMETER[x].PLUGINNAME + ".js";
			scriptname = "/plugins/" + scriptname;
			loadjscssfile(scriptname, "js"); //dynamically load and add this .js file
			//alert(scriptname);
		}
	}
	
	// Returns a list of Ports found on the mCU
	// {"COMMAND":"mcu_PORTSCAN","PARAMETER":[{"port":"/dev/ttyACM0"},{"port":"/dev/ttyS1"},{"port":"/dev/ttyS0"}]}
	function mCU_PORTSCAN() {
		jsonRET = getMarelabData('COMMAND=mcu_PORTSCAN');
		$("select#mCU_PORT option").remove();
		
		for (var i=0 ; i< jsonRET.PARAMETER.length; i++){
			$("select#mCU_PORT").append("<option>"+jsonRET.PARAMETER[i].port+"</option>");	
		}
	            
	}
	
	function mCU_CONFIGSAVE() {
		sC = new Object();
	    sC.COMMAND   = 'mcu_BUSSAVE';
	    sC.PORT = $("#mCU_PORT option:selected").text();
	    sC.BAUD = $("#mCU_BAUD option:selected").text();
	   	sC.DATABITS = '8';
	    sC.PARITY='N';
	    sC.STOPBITS = '1';
		para='test","PORT":"'+sC.PORT+'","BAUD":"'+sC.BAUD+'","DATABITS":"'+sC.DATABITS+'","PARITY":"'+sC.PARITY+'","STOPBITS":"'+sC.STOPBITS;

		jsonRET = getMarelabData('COMMAND=mcu_BUSSAVE&PARAMETER='+para);
	}
	
	// Add a mBD Device Row
	function addMBD_HTML(id,adress,major,minjor,name,uuid){
		var html = '<tr id="MBDROW'+id+'">';
		html = html + '<th width="70px" scope="col" align="left">';	
		html = html + '	<imgage ><img src="img/mbd.png" onClick="" ></imgage>';
		html = html + '</th>';
		html = html + '<th scope="col" align="left"> ';
		html = html + '	<table width="400px" border="0" cellspacing="4" cellpadding = "4">';
		html = html + '	<tr >';
		html = html + '		<th width="100px align="left" id="MDB-mCU-content1">';
		html = html + 			mlang["mBDBname"]+':';
		html = html + '		</th>';
		html = html + '		<th align="left" id="MDB-mCU-content2">';
		html = html + '			' + name +' UUID:' +uuid+' ';
		html = html + '		</th>';
		html = html + '	</tr> ';
		html = html + '	<tr>';
		html = html + '		<th width="100px align="left" id="MDB-mCU-content1">';
		html = html + mlang["Firmware"];
		html = html + '		</th>';
		html = html + '		<th align="left" id="MDB-mCU-content2">';
		version = major + "." + minjor;
		html = html + '			'+ version +' ';
		html = html + '		</th>';
		html = html + '	</tr>';
		html = html + '	<tr>';
		html = html + '		<th width="100px align="left" id="MDB-mCU-content1">';
		html = html + 			mlang["mBDAdress"]+':';
		html = html + '		</th>';
		html = html + '		<th align="left" id="MDB-mCU-content2">';
		html = html + '			' + adress+' ';
		html = html + '		</th>';
		html = html + '	</tr> ';
		html = html + '</table>';
		html = html + '</th>';
		html = html + '</tr>';
		return html;
	}
	
	

	
	
	
	// Scannt the BUS for mBD Devices
	function mcu_BUSSCAN(){
		// First del all devices on the DOM Tree
		$("[id^=MBDROW]").remove();
		
	    jsonRET = getMarelabData('COMMAND=mcu_BUSSCAN');
	    
	    for (x in jsonRET.PARAMETER) {
	    	adress = jsonRET.PARAMETER[x][0].ADRESS;
	    	major  = jsonRET.PARAMETER[x][1].MAJOR;
	    	minjor = jsonRET.PARAMETER[x][2].MINJOR;
	    	name   = jsonRET.PARAMETER[x][3].NAME;
	    	uuid   = jsonRET.PARAMETER[x][4].UUID;	
	    	$("table#MDB-TABLE-LIST").append(addMBD_HTML(x,adress,major,minjor,name,uuid));
		}
	    //$("#accordion" ).accordion({ heightStyle: "fill" });
	    //alert(jsonRET.PARAMETER[0][0].ADRESS);	
		
	}
	

	
	function doSomethingWithData(data) {
		content_plugin = data;
	} 
	
	// Creates the Menu with all plugins
	// Creates the Plugin List
	function CreatePluginMenu(){
		json = GET_PLUGININFO();
		
		// Logic Plugins
		for (var i=0 ; i< jsonRET.PARAMETER.length; i++){
					// Menu Entry
					$("#MENU_FOR_PLUGINS").append(PluginMenuEntry(jsonRET.PARAMETER[i].PLUGINNAME));
					// List of Logic Plugs
					$("#listOfPlugins").append(addPluginList_HTML(jsonRET.PARAMETER[i].PLUGINNAME,jsonRET.PARAMETER[i].PLUGINVERSION));
		}
		
		// Adapter Plugins
		jsonAdapterPlugs = getMarelabData('COMMAND=GET_ADAPTERINFO');
		
		for (var i=0 ; i< jsonAdapterPlugs.PARAMETER.length; i++){
			// List of Adapter Plugs
			$("#listOfPlugins").append(addPluginList_HTML(jsonAdapterPlugs.PARAMETER[i].PLUGINNAME,jsonAdapterPlugs.PARAMETER[i].PLUGINVERSION));
		}
		
		// Setts the setup marelab config vars table
		GET_MARELABSETUPDATA();
	}
		
	function PluginMenuEntry(name){
		return '<p class="PluginButton" id="'+name+'" onClick="MenuClicked(\''+name+'\');">'+ name +'</p>';
	}
	
	function SetupMenu(){
		$("#tabs-1").empty();
		$("#tabs-1").append(content_container);
		// Appand again the main menu
		$("#main_menu").empty();
		$("#main_menu").append(content_main_menu);
		generateLogicPlugin();
		
	}
	
	
	function MenuClicked(name){
		
		var content;
		// Copy the main menu to var
		//content_main_menu = $("#main_menu").html();
		$("#main_menu").empty();
		
		file2load = '/plugins/'+ name + '.html';
		var jqxhr = $.get(file2load, doSomethingWithData);
		jqxhr.complete(function(){ 
		//content_container = $("#tabs-1").html();
		$("#tabs-1").empty();
		$("#tabs-1").append(content_plugin);
		eval(name +"_Init();");
		//LedDimmer_Init();
		
		});		
		
	}
	
	
	
	// Adds the logmessages to the log div
	function refreshLogText(){
		$("p#loginfo").empty();
		jsonRET = getMarelabData('COMMAND=deamon_LOG');
	    $("p#loginfo").append(jsonRET.PARAMETER);
	}
	
	
	
	// Get LOG Messages from the marelab deamon
	function deamon_LOG(){		
		refreshLogText();
	    //logbut = '<button id="BUTTON" onclick="deamon_LOG()"></button>';	    
	    
	    $( "#dialoglog").dialog({ height: 400 , width: 500 , buttons: { close: function() { $( this ).dialog( "close" ); },
	    	refresh: function() { refreshLogText(); } }});
	   // $("#dialoglog").dialog({ height: 400 , width: 500 });
	}
	
	
	function changeText(name){
		document.getElementById(name).innerHTML = mlang[name];
	}
	
	
	
	
	
	
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///Plugin Logic & Adapter handling                                                                         //
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	function GET_PLUGININFO(){
		jsonRET = getMarelabData('COMMAND=GET_PLUGININFO');
		
		// Adding PluginInfos to internal Object struct
		pluginCount = jsonRET.PARAMETER.length;
		for (i=0; i<pluginCount;i++)
		{
			var PluginLogicObject = new Object();
			PluginLogicObject.Name = jsonRET.PARAMETER[i].PLUGINNAME;
			PluginLogicObject.Version = jsonRET.PARAMETER[i].PLUGINVERSION;
			PluginLogicObject.Adapter = "";
			PluginLogicObject.AdapterVersion="";
			PluginLogicObjectList[i] = PluginLogicObject;
		}
		return jsonRET;
	}
	
	
	
	
	
	function SaveLogicAdapterPluginConfig()
	{
		
		var AdpaterSelected;
		pluginCount = PluginLogicObjectList.length;
		for (i=0; i<pluginCount;i++)
		{
			PluginLogicObject = PluginLogicObjectList[i];
			whichAdapter = "AdapterList"+i;
			PluginLogicObject.Adapter = $("#"+whichAdapter+" option:selected").text();
		}
		//para='test","PORT":"'+sC.PORT+'","BAUD":"'+sC.BAUD+'","DATABITS":"'+sC.DATABITS+'","PARITY":"'+sC.PARITY+'","STOPBITS":"'+sC.STOPBITS;
		//alert (JSON.stringify(PluginLogicObjectList));
		jsonRET = getMarelabData('COMMAND=mcu_NUCLEUS_CONFIGSAVE&PARAMETER='+JSON.stringify(PluginLogicObjectList));	
	}
	
	// Get the HardwareAdapterConfig Dialog for a Logic Plugin
	function GetAdapterPluginConfigHTML(logicPluginName){
		// Removing exosting Adapter Config Html Code to the Config Adapter Dialog
		$("#AdapterConfigContent").empty();
		//'COMMAND=READ_CONFIG&PARAMETER="PLUGIN":"LedDimmer"'
		jsonRET = getMarelabData('COMMAND=ADAPTER_GET_CONFIG_HTML&PARAMETER="PLUGIN":"'+logicPluginName+ '"');
		// Adding the returned Adapter Config Html Code to the Config Adapter Dialog
		$("#AdapterConfigContent").append(jsonRET.HTML);
		$('#AdapterConfig' ).dialog();
  	}
	
	// Get the HardwareAdapterConfig as insert for table
	function GetAdapterPluginConfigHtmlTable(logicPluginName){
		//'COMMAND=READ_CONFIG&PARAMETER="PLUGIN":"LedDimmer"'
		jsonRET = getMarelabData('COMMAND=ADAPTER_GET_CONFIG_HTML&PARAMETER="PLUGIN":"'+logicPluginName+ '"');
		return jsonRET.HTML;
	
  	}
	

	
	function ReplaceAdapter(adapterName){
		alert(adapterName);
		//var replaceSpan = "span#Logic2Adapter"+logicplugin;
		//alert(replaceSpan);
		//$('span#Logic2Adapter1').html(adapterName);
	}
	
	function AdapterDialog(pluginhardware){
		//$('#AdapterDialog' ).dialog();
		//alert(pluginhardware[0].ADAPTER_NAME);
		//$('p#AdapterSelection').html.clear();
		var plugins = GET_PLUGININFO();
		var htmlout ="";
		var AdapterName="";
		adapterCount = plugins.PARAMETER[pluginhardware].PLUGINHARDWARE.length;
		for (i=0; i<adapterCount;i++)
		{
			AdapterName = plugins.PARAMETER[pluginhardware].PLUGINHARDWARE[i].ADAPTER_NAME
			htmlout = htmlout + "<input type='button' name='SetAdapter' value='Select' onclick='ReplaceAdapter("+AdapterName+");'> "+ plugins.PARAMETER[pluginhardware].PLUGINHARDWARE[i].ADAPTER_NAME + " version:" +plugins.PARAMETER[pluginhardware].PLUGINHARDWARE[i].ADAPTER_VERSION+"<br>";
		}
		
		$('p#AdapterSelection').html(htmlout);
		$('#AdapterDialog' ).dialog();
		
	}
	
	function generateLogicPlugin(){
		var pluginTable, AdapterSelect;
		AdapterSelect = "";
		plugintable = pluginTable + '<table width="400" border="0" cellspacing="0" cellpadding="0">';
		
		// MCU Version
		
		jsonRET = getMarelabData('COMMAND=mcu_VERSION');
		$("p#deamonVersion").html("Version:" + jsonRET.PARAMETER);
		$("spam#deamonVersion").html(jsonRET.PARAMETER);
		
		
		pluginTable = pluginTable + '  <tr>';
		pluginTable = pluginTable + '    <td colspan="2"><table width="100%" border="0" cellspacing="4" cellpadding="4">';
		pluginTable = pluginTable + '      <tr>';
		pluginTable = pluginTable + '        <td width="75" rowspan="2" bgcolor="#003366"><img src="img/marelab-logo-transparent.png" width="75" height="63" alt="ss" /></td>';
		pluginTable = pluginTable + '        <td colspan="3" bgcolor="#006699"><p>marelab nucleus mcu <br/>';
		pluginTable = pluginTable + '          Version: '+jsonRET.PARAMETER+' </p>';
		pluginTable = pluginTable + '       </td>';
		pluginTable = pluginTable + '      </tr>';
		pluginTable = pluginTable + '      <tr>';
		pluginTable = pluginTable + '        <td width="57" align="center" bgcolor="#006699"><input type="image" onclick="generateLogicPlugin();" src="img/REFRESH.png" width="32" height="32" alt="save config" /></td>';
		pluginTable = pluginTable + '        <td width="65" align="center" bgcolor="#006699"><img src="img/setup.png" alt="sd" width="32" height="32" /></td>';
		pluginTable = pluginTable + '        <td width="95" align="center" bgcolor="#006699"><input type="image" onclick="SaveLogicAdapterPluginConfig();" src="img/savef.png" width="32" height="32" alt="save config" /></td>';
		pluginTable = pluginTable + '      </tr>';
		pluginTable = pluginTable + '   </table></td>';
		pluginTable = pluginTable + '  </tr>';
		
		
		
		// Logic Plugins
		plugins = GET_PLUGININFO();
		pluginCount = plugins.PARAMETER.length
		for (i=0; i<pluginCount;i++)
		{
			AdapterSelect = "";
			pluginTable = pluginTable + '<tr>';
			pluginTable = pluginTable + '    <td valign="top"><img src="img/VERTICAL.png"  width="32" height="32" alt="aa"/></td>';
			pluginTable = pluginTable + '    <td>&nbsp;</td>';
			pluginTable = pluginTable + '</tr>';
			pluginTable = pluginTable + '<tr>';
			
			if (i<(pluginCount-1)){
				pluginTable = pluginTable + '<td valign="top"><img src="img/MIDDLE.png" width="32" height="32" alt="aa" /><br/>';
				pluginTable = pluginTable + '	<img src="img/VERTICAL.png"  width="32" height="32" alt="aa"/><br /> ';     
				pluginTable = pluginTable + '	<img src="img/VERTICAL.png"  width="32" height="32" alt="aa"/>';
				pluginTable = pluginTable + ' </td>';
				pluginTable = pluginTable + '<td>';
			}else{
				pluginTable = pluginTable + '<td valign="top"><img src="img/LAST.png" width="32" height="32" alt="aa" /><br/>';
				
				pluginTable = pluginTable + ' </td>';
				pluginTable = pluginTable + '<td>';
			}
			
		
			pluginTable = pluginTable + ' <table width="100%" border="0" cellpadding="4" cellspacing="4">';
			pluginTable = pluginTable + '  <tr>';
			pluginTable = pluginTable + '    <td width="87" rowspan="2" align="center" bgcolor="#003366"><input type="image" onclick="led_SAVECURVE();" src="img/'+plugins.PARAMETER[i].PLUGINNAME+'.png" width="32" height="32" alt="save config" /></td>';
			pluginTable = pluginTable + '    <td bgcolor="#006699">'+plugins.PARAMETER[i].PLUGINNAME+'<br />';
			pluginTable = pluginTable + 'Version: '+plugins.PARAMETER[i].PLUGINVERSION+'</td>';
			pluginTable = pluginTable + '    <td align="right" bgcolor="#006699"><input type="image" onclick="GetAdapterPluginConfigHTML(\''+plugins.PARAMETER[i].PLUGINNAME+'\');" src="img/setup.png" width="32" height="32" alt="config_hardwareAdapter" /></td>';
			pluginTable = pluginTable + '    <td align="right" bgcolor="#006699"><input type="image" onclick="SaveLogicAdapterPluginConfig();" src="img/savef.png" width="32" height="32" alt="save config" /></td>';
			pluginTable = pluginTable + '  </tr>';
			pluginTable = pluginTable + '  <tr>';
			logic2adapterName = 'Logic2Adapter'+i; 
			logic2adapterList = 'AdapterList'+i; 
			AdapterSelect = AdapterSelect + '<select name="AdapterSelect" id="'+logic2adapterList+'">';
			adapterCount = plugins.PARAMETER[i].PLUGINHARDWARE.length;
			for (ii=0; ii<adapterCount;ii++)
			{
				AdapterName = plugins.PARAMETER[i].PLUGINHARDWARE[ii].ADAPTER_NAME;
				AdapterNameSelected = plugins.PARAMETER[i].SELECTEDADAPTER;
				
				if (AdapterName === AdapterNameSelected ){
					AdapterSelect = AdapterSelect +  '<option value="'+AdapterName+'" selected>'+AdapterName+'</option>';
				}
				else{
					AdapterSelect = AdapterSelect +  '<option value="'+AdapterName+'">'+AdapterName+'</option>';
				}
			}
			AdapterSelect = AdapterSelect + '</select>';
			
			
			pluginTable = pluginTable + '    <td align="left" bgcolor="#006699">Adapter: <span id="'+logic2adapterName+'">'+AdapterSelect+'</span></td>';
			pluginTable = pluginTable + '    <td width="30" align="center" bgcolor="#006699"><input type="image" onclick="AdapterDialog('+i+');" src="img/hardware.png" width="32" height="32" alt="sd" /></td>';
			pluginTable = pluginTable + '    <td width="34" align="center" bgcolor="#006699"><img src="img/onoff.png" width="32" height="32" alt="as" /></td>';
			
			
			//<!-- ADDING HARDWARE/CHIPS CONFIG 
			//pluginTable = pluginTable + '    <td align="right" bgcolor="#006699">'+GetAdapterPluginConfigHTML(plugins.PARAMETER[i].PLUGINNAME)+'</td>';
			
			//-->
			
			pluginTable = pluginTable + '   </tr>';
			pluginTable = pluginTable + ' </table>';
			pluginTable = pluginTable + '  </td>';
			pluginTable = pluginTable + '   </tr>';
		}
		
		

		  
		pluginTable = pluginTable + '</table>';
		
		$("#pluginadaperlist").html(pluginTable);
		
	}
	
	//function HtmlInjection(id_target,htmlinjection)
	function HtmlInjection(ID_SELECT,textinsert)
	{
		// Get the option selected 
		var selectName = $('#CHIPSET_SELECT').find(":selected").text();
		
		$("#"+ID_SELECT).html("<td>"+selectName+"</td>");
	}
	
	
	function ConnectorDialog(titel,content){
		//var plugins = GET_PLUGININFO();
		var htmlout = content;
		var AdapterName="";
		//adapterCount = plugins.PARAMETER[pluginhardware].PLUGINHARDWARE.length;
		//for (i=0; i<adapterCount;i++)
		//{
		//	AdapterName = plugins.PARAMETER[pluginhardware].PLUGINHARDWARE[i].ADAPTER_NAME
		//	htmlout = htmlout + "<input type='button' name='SetAdapter' value='Select' onclick='ReplaceAdapter("+AdapterName+");'> "+ plugins.PARAMETER[pluginhardware].PLUGINHARDWARE[i].ADAPTER_NAME + " version:" +plugins.PARAMETER[pluginhardware].PLUGINHARDWARE[i].ADAPTER_VERSION+"<br>";
		//}
		
		$('p#ConnectorConfigContent').html(htmlout);
		$('#ConnectorConfig' ).dialog({
			width: 800,
			height: 250});
		
	}
	
	
	// GETS THE LOCAL TIME
	function GetTime(){
		jsonRET = getMarelabData('COMMAND=GETTIME');
		return jsonRET;
	}
	
	// GETS THE SYSINFO 
	function GetSysInfo(){
		jsonRET = getMarelabData('COMMAND=SYSINFO');
		return jsonRET;
	}
	
	function startTime()
	{
		var timeobject = GetTime();   // Gets time from marelab
	
		
	
	var h=timeobject.HOUR;
	var m=timeobject.MIN;
	var s=timeobject.SEC;
	var day = timeobject.DAY;
	var month = timeobject.MONTH;
	var year = timeobject.YEAR;
	var uptime = timeobject.UPTIME;
	// add a zero in front of numbers<10
	m=checkTime(m);
	s=checkTime(s);
	document.getElementById('CLOCK').innerHTML= "uptime: "+(Math.floor(uptime/60))+"min date:" + day+"."+month+"."+year+"  "+h+":"+m+":"+s;
	t=setTimeout(function(){startTime()},1000);
	}

	function checkTime(i)
	{
	if (i<10)
	  {
	  i="0" + i;
	  }
	return i;
	}

	
	
	// GETS THE CONFIG VARS FROM MARELAB AND DISPLAYS THEM
	///////////////////////////////////////////////////////////////////////////
	function CreateTable(obj) {
	        var table = $('<table cellspacing="4" cellpadding = "4"></table>');
	        var th = $('<tr></tr>');
	       
	        for (var j = 0; j < obj.length; j++) {
	            var tr = $('<tr></tr>');
	            for (var key in obj[j]) {
	            	tr.append('<td align="left" id="MDB-mCU-content1">' + key + '</td>');	
	                tr.append('<td align="left" id="MDB-mCU-content2"><input id="INPUTFIELD" name="'+key+'" value="'+ obj[j][key] + '"/></td>');
	                MARELAB_CONFIG_LIST[j] = obj[j];
	             }
	            table.append(tr); 
	        }
	        return table;
	    }
	
	
	function GET_MARELABSETUPDATA()
	{
		jsonRET = getMarelabData('COMMAND=GETMARELABSETUPDATA');
		$('#listOfMarelabConfigVars').html(CreateTable(jsonRET.CONFIGDATA, 2));
	}
	// saving the marelab config values
	function SAVE_MARELABSETUPDATA()
	{
		//var myJSONText = JSON.stringify(myObject, replacer);
		 for (var j = 0; j < MARELAB_CONFIG_LIST.length; j++) {
			 for (var key in MARELAB_CONFIG_LIST[j]) {
			 	var inputvalue = $('input[name="'+ key+'"]').val();
			 	MARELAB_CONFIG_LIST[j][key] = inputvalue;
			 }
		 }
		//jsonRET = getMarelabData('COMMAND=SETMARELABSETUPDATA');
		var myJSONText = JSON.stringify(MARELAB_CONFIG_LIST);
		jsonRET = getMarelabData('COMMAND=SETMARELABSETUPDATA&PARAMETER="MARELAB_CONFIG":'+myJSONText);
	}

	
	// Managment of the Connectors for logical & physical Plugins / Adapters
	// The Classes are storing the connectors that can be bound to each other
	function randomUUID() {
  		var s = [], itoh = '0123456789ABCDEF';
 
  		// Make array of random hex digits. The UUID only has 32 digits in it, but we
  		// allocate an extra items to make room for the '-'s we'll be inserting.
  		for (var i = 0; i < 36; i++) s[i] = Math.floor(Math.random()*0x10);
 
  		// Conform to RFC-4122, section 4.4
  		s[14] = 4;  // Set 4 high bits of time_high field to version
  		s[19] = (s[19] & 0x3) | 0x8;  // Specify 2 high bits of clock sequence
 
  		// Convert to hex chars
  		for (var i = 0; i < 36; i++) s[i] = itoh[s[i]];
 
  		// Insert '-'s
  		s[8] = s[13] = s[18] = s[23] = '-';
 
  		return s.join('');
	  }
	/*
	/*
    var p1 = new PhysicalAdapterConnector("520","0x40",1,"DA 8 Bit",0,"OUT");
	var p2 = new PhysicalAdapterConnector("520","0x40",2,"DA 8 Bit",0,"OUT");
	var p3 = new PhysicalAdapterConnector("520","0x40",3,"DA 8 Bit",0,"OUT");
	var p4 = new PhysicalAdapterConnector("520","0x40",4,"DA 8 Bit",0,"OUT");
	
	var PhyConList = new PhysicalAdapterConnectorList();
	PhyConList.Add(p1);
	PhyConList.Add(p2);
	PhyConList.Add(p3);
	PhyConList.Add(p4);
	console.log( PhyConList.toString());
	
	alert(PhyConList.Find("520","0x40",0).toString());
    */
    
    // Gets all Physical Connectors from all Adapters to fill the 
    // PhysicalAdapterConnectorList that is used to configure all Logical plugins
    // with a physical port
    /*
    {
     "COMMAND":"GET_ALL_PHYSICAL_CONNECTORS",
     "CONNECTOR":{
    	          "PHYSICAL_CONNETOR_LIST":
    	          [
    	           {"CHIPS_ON_BUS":
    	        	  [
    	        	   {"CHIPTYP":"PCF8574","CONNECTORS":
    	        		  [
    	        		   {"DESCRIPTION":"PCF8574 IO-0","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-1","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-2","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-3","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-4","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-5","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-6","DIR":2,"HWTYPE":0},
    	        		   {"DESCRIPTION":"PCF8574 IO-7","DIR":2,"HWTYPE":0}
    	        		  ]
    	        	   },
    	        	   {"CHIPTYP":"MAX520","CONNECTORS":
    	        		  [
    	        		   {"DESCRIPTION":"MAX520 DA-1","DIR":1,"HWTYPE":1},
    	        		   {"DESCRIPTION":"MAX520 DA-2","DIR":1,"HWTYPE":1},
    	        		   {"DESCRIPTION":"MAX520 DA-3","DIR":1,"HWTYPE":1},
    	        		   {"DESCRIPTION":"MAX520 DA-4","DIR":1,"HWTYPE":1}
    	        		  ]
    	        	   }
    	        	  ],
    	        	  "PLUGIN_NAME":"I2C Adapter",
    	        	  "PLUGIN_VERSION":"0.1",
    	        	  "TYPE_OF_PLUGIN":"ADAPTER"
    	        	 }
    	           ]
    }
    }
    */
    var PhysicalConList = new PhysicalAdapterConnectorList();
    var LogicalConList = new LogicalAdapterConnectorList();
    
    
    function GetAllPhysicalConnectors(){
    	para = '"PLUGINNAME":"I2C Adapter"';
    	var PHYSICAL_CONNECTOR = getMarelabData('COMMAND=GET_ALL_PHYSICAL_CONNECTORS&PARAMETER=' + para);
    	//alert (JSON.stringify(PHYSICAL_CONNECTOR));
    	
    	var BUS =  PHYSICAL_CONNECTOR.CONNECTOR.PHYSICAL_CONNETOR_LIST[0].CHIPS_ON_BUS;
    	var htmliotable="";
    	for (var CHIPS in BUS) {
    		//alert (JSON.stringify(BUS[CHIPS].CHIPTYP));
    		var plugin_name = PHYSICAL_CONNECTOR.CONNECTOR.PHYSICAL_CONNETOR_LIST[0].PLUGIN_NAME;
    		var chiptype   = BUS[CHIPS].CHIPTYP;
    		var device_adr = BUS[CHIPS].DEVICE_ADR;
    		var device_no  = BUS[CHIPS].DEVICE_NO;
    		var device_bus = BUS[CHIPS].DEVICE_BUS;
    		
    		for (var CONNETOR in BUS[CHIPS].CONNECTORS)
    		{
    			//channel 		= BUS[CHIPS].CONNECTORS[CONNETOR];				// Channel Data is send to for exp. Port 1..8
    			description		= BUS[CHIPS].CONNECTORS[CONNETOR].DESCRIPTION;	// Description of the Port
    			dir				= BUS[CHIPS].CONNECTORS[CONNETOR].DIR;			// Data Direction the port can recv, trans, bi
    			hwtype			= BUS[CHIPS].CONNECTORS[CONNETOR].HWTYPE;
    			uuid			= BUS[CHIPS].CONNECTORS[CONNETOR].UUID;	
    			
    			var connector = new PhysicalAdapterConnector(plugin_name,chiptype,device_adr,device_no,device_bus,CONNETOR,description,dir,hwtype,uuid);
    			PhysicalConList.Add(connector);
    		}	
    		//htmliotable = htmliotable + CreateTableView(IO_PIN);
    	}	
    	//
    	//alert (PhyConList.toString());
    }
    
    // Gets a JSON result form marelab-nucleus of all Logical Plugin Connectors needed
    function GetAllLogicalConnectors(){
    	para = '"PLUGINNAME":"I2C Adapter"';
    	var LOGICAL_CONNECTOR = getMarelabData('COMMAND=GET_ALL_LOGICAL_CONNECTORS&PARAMETER=' + para);
    	//alert (JSON.stringify(LOGICAL_CONNECTOR));
    
    	var PLUGINS =  LOGICAL_CONNECTOR.CONNECTOR.LOGICAL_CONNETOR_LIST;
    	var htmliotable="";
    	for (var pluginno in PLUGINS) {
    		var plugin_name 	= LOGICAL_CONNECTOR.CONNECTOR.LOGICAL_CONNETOR_LIST[pluginno].PLUGIN_NAME;
    		var plugin_version  = LOGICAL_CONNECTOR.CONNECTOR.LOGICAL_CONNETOR_LIST[pluginno].PLUGIN_VERSION;
    		
    		for (var CONNETOR in PLUGINS[pluginno].CONNECTORS)
    		{
    			description		= PLUGINS[pluginno].CONNECTORS[CONNETOR].DESCRIPTION;	// Description of the Port
    			dir				= PLUGINS[pluginno].CONNECTORS[CONNETOR].DIR;			// Data Direction the port can recv, trans, bi
    			hwtype			= PLUGINS[pluginno].CONNECTORS[CONNETOR].HWTYPE;
    			uuid			= PLUGINS[pluginno].CONNECTORS[CONNETOR].UUID;	
    			
    			var connector = new LogicalAdapterConnector(plugin_name,plugin_version,description,dir,hwtype,uuid);
    			LogicalConList.Add(connector);
    		}	
    		//htmliotable = htmliotable + CreateTableView(IO_PIN);
    	}	
    	
    	//alert (LogicalConList.toString());
    	
    }
    
    GetAllPhysicalConnectors();
    GetAllLogicalConnectors();
	
    var ListOfPhyPlugs = PhysicalConList.GetNameListOfPlugins();
    var ListOfLogPlugs = LogicalConList.GetNameListOfPlugins();
    
    function DebugPluginConnectorList()
    {
   
		console.log("Physical Plugins");
		console.log("--------------------------------------");
		for (i = 0; i < ListOfPhyPlugs.length; i++) {
			console.log(" Connectors for " + ListOfPhyPlugs[i] + ":");
			for (ii = 0; ii < PhysicalConList.GetList().length; ii++) {
				if (PhysicalConList.GetList()[ii].getPLUGIN_NAME() == ListOfPhyPlugs[i])
					console.log(" No: "+ PhysicalConList.GetList()[ii].getDEVICE_NO() +" ChipTyp: "+ PhysicalConList.GetList()[ii].getCHIPTYPE() + " Description: "+ PhysicalConList.GetList()[ii].getDESCRIPTION() + " Dir: "+ PhysicalConList.GetList()[ii].getDIR()+ " UUID:"+ PhysicalConList.GetList()[ii].getUUID());
			}

		}
		console.log(" ");
		console.log("Logical Plugins");
		console.log("-------------------------------------");

		for (i = 0; i < ListOfLogPlugs.length; i++) {
			console.log(" Connectors for " + ListOfLogPlugs[i] + ":");

			for (ii = 0; ii < LogicalConList.GetList().length; ii++) {
				if (LogicalConList.GetList()[ii].getPLUGIN_NAME() == ListOfLogPlugs[i])
					console.log(" Description: "+ LogicalConList.GetList()[ii].getDESCRIPTION() + " Dir: "+ LogicalConList.GetList()[ii].getDIR()+ " UUID:"+ LogicalConList.GetList()[ii].getUUID());
				
			}

		}
	}

	DebugPluginConnectorList();
	//var htmlDIALOG = "<div class='ANON_DIALOG' title='IO Connectors to select'>"+ htmliotable +"</div>";
	//var htmlDIALOG = "<div class='ANON_DIALOG'></div>";

	// Class for Logical Adapter Plugins (like Dimmer, Stream etc..)
	function LogicalAdapterConnector(plugin_name, plugin_version, description,
			dir, hwtype, uuid) {
		var PLUGIN_NAME = plugin_name;
		var PLUGIN_VERSION = plugin_version; // Name of the hardware chip
		var DESCRIPTION = description; // Description of the Port
		var DIR = dir; // Data Direction the port can recv, trans, bi
		var HWTYPE = hwtype; // Type of Port (IN,OUT,BI, DA,AD)
		var UUID = uuid;

		this.getPLUGIN_NAME = function() {
			return PLUGIN_NAME;
		};
		this.getPLUGIN_VERSION = function() {
			return PLUGIN_VERSION;
		};
		this.getDESCRIPTION = function() {
			return DESCRIPTION;
		};
		this.getDIR = function() {
			return DIR;
		};
		this.getHWTYPE = function() {
			return HWTYPE;
		};
		this.getUUID = function() {
			return UUID;
		};

		this.toString = function() {
			var retstring = "";
			retstring = "PLUGIN_NAME=" + PLUGIN_NAME + "\r\n";
			retstring = retstring + "PLUGIN_VERSION=" + PLUGIN_VERSION + "\r\n";
			retstring = retstring + "DESCRIPTION=" + DESCRIPTION + "\r\n";
			retstring = retstring + "DIR=" + DIR + "\r\n";
			retstring = retstring + "HWTYPE=" + HWTYPE + "\r\n";
			retstring = retstring + "UUID=" + UUID + "\r\n";
			return retstring;
		};

		this.getPLUGIN_NAME = function() {
			return PLUGIN_NAME;
		};

		return this;
	}

	function LogicalAdapterConnectorList() {
		var logicalAdapterList = new Array();

		this.GetList = function() {
			return logicalAdapterList;
		};

		this.Add = function(adapter) {
			logicalAdapterList.push(adapter);
		};

		this.Find = function(plugin_name, chiptype, chipadress, dir) {
			var foundLogicalConnector = new Array();
			for (i = 0; i < logicalAdapterList.length; i++) {
				if ((logicalAdapterList[i].PLUGIN_NAME == plugin_name)
						&& (logicalAdapterList[i].CHIPTYPE == chiptype)
						&& (logicalAdapterList[i].CHIPADRESS == chipadress)
						&& (logicalAdapterList[i].DIR == dir))
					;
				foundLogicalConnector.push(logicalAdapterList[i]);
			}
			return foundLogicalConnector;
		};

		this.toString = function() {
			var stringret = "";
			for (i = 0; i < logicalAdapterList.length; i++) {
				stringret = stringret + logicalAdapterList[i].toString();
			}
			return stringret;

		};

		// Gets all unique Plugin Names from Array
		this.GetNameListOfPlugins = function() {
			var pluginList = new Array();
			var stringret = "";
			for (i = 0; i < logicalAdapterList.length; i++) {
				if ($.inArray(logicalAdapterList[i].getPLUGIN_NAME(),
						pluginList) == -1)
					pluginList.push(logicalAdapterList[i].getPLUGIN_NAME());

			}
			return pluginList;
		};

		return this;
	}

	// Class for Physical Adapter Plugins (Like I2C, Modbus etc.)
	function PhysicalAdapterConnector(plugin_name, chiptype, deviceadr,
			deviceno, devicebus, channel, description, dir, hwtype, uuid) {
		var PLUGIN_NAME = plugin_name;
		var CHIPTYPE = chiptype; // Name of the hardware chip
		var DEVICE_ADR = deviceadr;
		var DEVICE_NO = deviceno;
		var DEVICE_BUS = devicebus;
		var CHANNEL = channel; // Channel Data is send to for exp. Port 1..8
		var DESCRIPTION = description; // Description of the Port
		//enum CONNECTION_TYP{IO, DA, AD};
		//enum CONNECTION_DIR{IN, OUT, BI};
		var DIR = dir; 			// Data Direction the port can recv, trans, bi
		var HWTYPE = hwtype; 	// Type of Port (IN,OUT,BI, DA,AD)
		var UUID = uuid;

		this.getPLUGIN_NAME = function() {
			return PLUGIN_NAME;
		};
		this.getCHIPTYPE = function() {
			return CHIPTYPE;
		};
		this.getDEVICE_ADR = function() {
			return DEVICE_ADR;
		};
		this.getDEVICE_NO = function() {
			return DEVICE_NO;
		};
		this.getDEVICE_BUS = function() {
			return DEVICE_BUS;
		};
		this.getCHANNEL = function() {
			return CHANNEL;
		};
		this.getDESCRIPTION = function() {
			return DESCRIPTION;
		};
		this.getDIR = function() {
			return DIR;
		};
		this.getHWTYPE = function() {
			return HWTYPE;
		};
		this.getUUID = function() {
			return UUID;
		};

		this.toString = function() {
			var retstring = "";
			retstring = "CHIPTYPE=" + CHIPTYPE + "\r\n";
			retstring = retstring + "PLUGIN_NAME=" + PLUGIN_NAME + "\r\n";
			retstring = retstring + "DEVICE_ADR=" + DEVICE_ADR + "\r\n";
			retstring = retstring + "DEVICE_NO=" + DEVICE_NO + "\r\n";
			retstring = retstring + "DEVICE_BUS=" + DEVICE_BUS + "\r\n";
			retstring = retstring + "CHANNEL=" + CHANNEL + "\r\n";
			retstring = retstring + "DESCRIPTION=" + DESCRIPTION + "\r\n";
			retstring = retstring + "DIR=" + DIR + "\r\n";
			retstring = retstring + "HWTYPE=" + HWTYPE + "\r\n";
			retstring = retstring + "UUID=" + UUID + "\r\n";
			return retstring;
		};
		return this;
	}

	function PhysicalAdapterConnectorList() {
		var phyAdapterList = new Array();

		this.GetList = function() {
			return phyAdapterList;
		};

		this.Add = function(adapter) {
			phyAdapterList.push(adapter);
		};

		this.Find = function(plugin_name, chiptype, chipadress, dir) {
			var foundPhyConnector = new Array();
			for (i = 0; i < phyAdapterList.length; i++) {
				if ((phyAdapterList[i].PLUGIN_NAME == plugin_name)
						&& (phyAdapterList[i].CHIPTYPE == chiptype)
						&& (phyAdapterList[i].CHIPADRESS == chipadress)
						&& (phyAdapterList[i].DIR == dir))
					;
				foundPhyConnector.push(phyAdapterList[i]);
			}
			return foundPhyConnector;
		};

		this.toString = function() {
			var stringret = "";
			for (i = 0; i < phyAdapterList.length; i++) {
				stringret = stringret + phyAdapterList[i].toString();
			}
			return stringret;

		};

		// Gets all unique Plugin Names from Array
		this.GetNameListOfPlugins = function() {
			var pluginList = new Array();
			var stringret = "";
			for (i = 0; i < phyAdapterList.length; i++) {
				if ($.inArray(phyAdapterList[i].getPLUGIN_NAME(), pluginList) == -1)
					pluginList.push(phyAdapterList[i].getPLUGIN_NAME());

			}
			return pluginList;
		};
		
		// Gets all unique Chips of a Adapter from Physical Connetor Array
		this.GetNameListOfChips = function(adapterPluginName) {
			var pluginList = new Array();
			var stringret = "";
			for (i = 0; i < phyAdapterList.length; i++) {
				if (phyAdapterList[i].getPLUGIN_NAME()==adapterPluginName){
					if ($.inArray(phyAdapterList[i].getCHIPTYPE(), pluginList) == -1)
						pluginList.push(phyAdapterList[i].getCHIPTYPE());
				}
			}
			return pluginList;
		};
		
		this.DropDownChips= function(adapterPluginName,idfordopdown){
			var select = '<select id=\''+idfordopdown+'\' class=\'PLUGINDROPDOWNSTYLE\'>';
			var ListOfChips = this.GetNameListOfChips(adapterPluginName);
			select= select +  '<option value=\'-1\'>please select</option>';				
			for (var ii = 0; ii < ListOfChips.length; ii++) {
					select= select +  '<option value=\''+ ListOfChips[ii] +'\'>' + ListOfChips[ii]+ '</option>';				
			}
			select = select + '</select>';
			return select;
		}
		
		// Gets all unique Adresses for a Chip of a Adapter from Physical Connetor Array
		this.GetAdressForChips = function(adapterPluginName,chiptype) {
			var pluginList = new Array();
			var stringret = "";
			for (i = 0; i < phyAdapterList.length; i++) {
				if ((phyAdapterList[i].getCHIPTYPE()==chiptype)&&(phyAdapterList[i].getPLUGIN_NAME()==adapterPluginName)){
					if ($.inArray(phyAdapterList[i].getDEVICE_ADR(), pluginList) == -1)
						pluginList.push(phyAdapterList[i].getDEVICE_ADR());
				}
			}
			return pluginList;
		};
		
		this.DropDownAdress= function(adapterPluginName,chiptype,idfordopdown){
			var select = '<select id=\''+idfordopdown+'\' class=\'PLUGINDROPDOWNSTYLE\'>';
			var ListOfAdress = this.GetAdressForChips(adapterPluginName,chiptype);
			select= select +  '<option value=\'-1\'>please select</option>';
			for (var ii = 0; ii < ListOfAdress.length; ii++) {
					select= select +  '<option value=\''+ ListOfAdress[ii] +'\'>' + ListOfAdress[ii]+ '</option>';				
			}
			select = select + '</select>';
			return select;
		}
		
		// Gets all unique Ports for a Chip with Adress xx of a Adapter from Physical Connetor Array
		this.GetPortsForChips = function(adapterPluginName,chiptype,adress) {
			var pluginList = new Array();
			var stringret = "";
			for (i = 0; i < phyAdapterList.length; i++) {
				if ((phyAdapterList[i].getCHIPTYPE()==chiptype)&&(phyAdapterList[i].getPLUGIN_NAME()==adapterPluginName)&&(phyAdapterList[i].getDEVICE_ADR()==adress)){
						pluginList.push(phyAdapterList[i].getDESCRIPTION());
				}
			}
			return pluginList;
		};
		
		this.DropDownPorts= function(adapterPluginName,chiptype,adress,idfordopdown){
			var select = '<select id=\''+idfordopdown+'\' class=\'PLUGINDROPDOWNSTYLE\'>';
			var ListOfPorts = this.GetPortsForChips(adapterPluginName,chiptype,adress);
			select= select +  '<option value=\'-1\'>please select</option>';
			for (var ii = 0; ii < ListOfPorts.length; ii++) {
					select= select +  '<option value=\''+ ii +'\'>' + ListOfPorts[ii]+ '</option>';				
			}
			select = select + '</select>';
			return select;
		}
		
		this.DropDownAllConnectors =  function (adapterPluginName,idfordopdown,dir,hwtype){
			var select = '<select id=\''+idfordopdown+'\' class=\'PLUGINDROPDOWNSTYLE\'>';
			select= select +  '<option value=\'999\'>please change</option>';				
			for (var ii = 0; ii < PhysicalConList.GetList().length; ii++) {
				var useDir = -1;
				
				if (PhysicalConList.GetList()[ii].getDIR() == ConDirEnum.BI ) // Bi Directional Port
				    useDir = dir;
				else
					useDir = PhysicalConList.GetList()[ii].getDIR();
				
				if ((PhysicalConList.GetList()[ii].getPLUGIN_NAME() == adapterPluginName)&&
					(PhysicalConList.GetList()[ii].getHWTYPE() == hwtype)&&
					(useDir == dir))
					{
						select= select +  '<option value=\''+ ii +'\'>' + PhysicalConList.GetList()[ii].getDEVICE_NO()+' - '+ PhysicalConList.GetList()[ii].getDEVICE_ADR()+' - '+ PhysicalConList.GetList()[ii].getDESCRIPTION() + '</option>';				
					}
			}
			select = select + '</select>';
			return select;
		}
		return this;
	}
	
	// UTIL PLUGIN FUNCTIONS
	///////////////////////////////////////
	
	function GenerateLogic2PhysicTable(nameOfLogicPlugin,appendDiv){
		var $table = $('<table class="PLUGINTABLESTYLE" />');
		for (var ii = 0; ii < LogicalConList.GetList().length; ii++) {
			if (LogicalConList.GetList()[ii].getPLUGIN_NAME() == nameOfLogicPlugin)
			{
				text2ins = '<tr><td>' + LogicalConList.GetList()[ii].getDESCRIPTION() + '</td>' + //'<td>' + '</td></tr>' );				
				'<td>' + 																				// Dir / type
				PhysicalConList.DropDownAllConnectors("I2C Adapter",LogicalConList.GetList()[ii].getUUID(),1,1) + 
				PhysicalConList.DropDownChips("I2C Adapter","CHIP_DROP_DOWN")+
				PhysicalConList.DropDownAdress("I2C Adapter","PCF8574","ADRESS_DROP_DOWN")+
				PhysicalConList.DropDownPorts("I2C Adapter","PCF8574","31","PORT_DROP_DOWN")+
				'</td></tr>' ;
				//alert(text2ins);
				$table.append( text2ins);			
			}
				//LogicalConList.GetList()[ii].getDESCRIPTION()
				//LogicalConList.GetList()[ii].getDIR() 
				//LogicalConList.GetList()[ii].getUUID()
		}
	
		//table.append('</table>');
		$('#TestList').append('Logic Plugin connections:');
		$('#TestList').append($table);
		
		//$('#ConnectorConfigContent').append(table);
	}
	
	function GetPhysicalAdapter(logicalAdapter)
	{
		var plugins = GET_PLUGININFO();
		//alert (JSON.stringify(plugins));
		
		/*
		{"COMMAND":[{"COMMAND":"GET_PLUGININFO"}],
		 "PARAMETER":[
		              {"COMMAND":"GET_PLUGININFO",
		               "PLUGINHARDWARE":[
		                                 {"ADAPTER_NAME":"GPIO Adapter","ADAPTER_VERSION":"0.1"},
		                                 {"ADAPTER_NAME":"Modbus Adapter","ADAPTER_VERSION":"0.1"},
		                                 {"ADAPTER_NAME":"I2C Adapter","ADAPTER_VERSION":"0.1"}
		                                 ],
		                "PLUGINNAME":"Stream",
		                "PLUGINVERSION":"0.1",
		                "SELECTEDADAPTER":"I2C Adapter"
		               },
		               {"PLUGINHARDWARE":[
		                                  {"ADAPTER_NAME":"GPIO Adapter","ADAPTER_VERSION":"0.1"},
		                                  {"ADAPTER_NAME":"Modbus Adapter","ADAPTER_VERSION":"0.1"},
		                                  {"ADAPTER_NAME":"I2C Adapter","ADAPTER_VERSION":"0.1"}
		                                  ],
		                "PLUGINNAME":"LedDimmer",
		                "PLUGINVERSION":"0.2",
		                "SELECTEDADAPTER":"I2C Adapter"}
		               ]
		}
		*/		
		plugins = GET_PLUGININFO();
		pluginCount = plugins.PARAMETER.length
		for (i=0; i < pluginCount;i++)
		{
			if (plugins.PARAMETER[i].PLUGINNAME == logicalAdapter)
					return plugins.PARAMETER[i].SELECTEDADAPTER;
		}
		return "";
	}
	
	
	// End Managment
</script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width">

</head>
<title>marelab reef control</title>
<body >

	<div id="titel_setup">
		<div id="TOOLBAR-TITEL">
			<img src="img/logo2-marelab.png">
		</div>
		<div id="TOOLBAR">
			<!--  <button id="test" onClick="LedDimmer();">TEST</button>-->
			<!--<span id="main_menu">
				<button id="SAVEPORT" onclick="mCU_CONFIGSAVE()">save</button>
			</span>-->
			<div id ="CLOCK">FR 02:04:2014 20:00:00</div>
			<input type="image" onclick="deamon_LOG();" src="img/loginfo.png" width="32" height="32" alt="save config" />
			<input type="image" onclick="deamon_LOG();" src="img/loginfo.png" width="32" height="32" alt="save config" />
			<input type="image" onclick="deamon_LOG();" src="img/loginfo.png" width="32" height="32" alt="save config" />
			
			<!-- 
			<button id="BUTTONTIME" onclick="GetTime();">time</button>
			<button id="BUTTONTIME" onclick="GetSysInfo();">time</button>
			 -->
		</div>
	</div>
	<div id="container-content">
		<div id="tabs">
			<div id="LINKS">
				<!-- ************************************** -->
				<!-- FILL PLUGIN MENUS -->
				<!-- ************************************** -->
				<div id="PLUGIN_MENU"></div>
				<div id="MENU_FOR_PLUGINS"></div>
				<p class="PluginButton" onClick="SetupMenu();">Setup</p>
				
				<!-- ************************************** -->
				<!-- OS INFO LINUX                          -->
				<!-- ************************************** -->
				<p class="PluginButton" onClick="">OS Info</p>
				
				<!-- ************************************** -->
				<!-- FILL PLUGIN MENUS -->
				<!-- ************************************** -->			
			</div>
			
	
			
			<div id="tabs-1">
				<div id="RECHTS">
					<!-- **************   SETUP CONTENT ********************* -->
					<!-- 
						<div id="titel_setup_content">
						<div class="TOOLBAR-TITEL" id="TOOLBAR-TITEL-PORTSETTING"><script>changeText('TOOLBAR-TITEL-PORTSETTING');</script></div>
						<div id="TOOLBAR">
							<button id="PORTSCAN" onclick="mCU_PORTSCAN()"><script>changeText('PORTSCAN');</script></button>
						</div>
					</div>
					<div id="container">
						<div id="LINKS">
							
						</div>
						<div id="RECHTS" class=".ui-accordion-header">
						<span id="portDescription">
						<script>changeText('portDescription');</script>
							
							</span>
							<br></br>
							<table border="0" cellspacing="0" cellpadding="0">
								<tr>
									<th scope="col" align="left" id="PortInputFieldName"><script>changeText('PortInputFieldName');</script></th>
									<th scope="col" align="left"><select id="mCU_PORT"
										size="1"><option>*UNDEFINED*</option></select></th>
								</tr>
								<tr>
									<th scope="col" align="left" id="PortBaudFieldName"><script>changeText('PortBaudFieldName');</script></th>
									<th scope="col" align="left"><select id="mCU_BAUD"
										size="1">
											<option>2400</option>
											<option>4800</option>
											<option>9600</option>
											<option>19200</option>
											<option>38400</option>
											<option>57600</option>
											<option>115200</option>
									</select></th>
								</tr>
							</table>

							</th>
							</tr>

							</table>
						</div>
						<br></br>
					</div>
					-->
					<div id="titel_setup_content">
						<div class="TOOLBAR-TITEL" id="titelmBDDeviceList">
							<script>changeText('titelmBDDeviceList');</script>
						</div>
						<div id="TOOLBAR">
							<!-- 
							OLD MODBUS 
							<button id="BUTTON_SCAN_MBD" onclick="mcu_BUSSCAN()">
								<script>changeText('BUTTON_SCAN_MBD');</script>
							</button>
							<!-- <div id='myProgressBar'></div> -->
							 
						</div>
					</div>
					<div id="container">
						<!-- START OF mBD SETUP & SCAN -->
						<!-- ************************* -->
						<div id="LINKS">
							<!-- FILL -->
						</div>
						<div id="RECHTS" class=".ui-accordion-header">

							<span id="pluginadaperlist"></span>

						</div>
					</div>

					<div id="titel_setup_content">
						<div class="TOOLBAR-TITEL" id="toolbarTitelPluginsInstalled">
							<script>changeText('toolbarTitelPluginsInstalled');</script>
						</div>
						<div id="TOOLBAR">
							<input type="image" onclick="GET_PLUGININFO();" src="img/REFRESH.png" width="32" height="32" alt="refresh plugin list" />
							<!-- <button id="BUTTON_SCAN_PLUGIN" onclick="GET_PLUGININFO()">refresh</button> -->
						</div>
					</div>
					<div id="container">
						<!-- START OF PLUGIN SCAN -->
						<!-- ************************* -->
						<div id="LINKS">
							<!-- FILL -->
						</div>
						<div id="RECHTS">
							<div id="listOfPlugins">
								<!-- LIST OF PLUGINS -->
								<!-- ************************* -->
							</div>
						</div>
					</div>
					
					<!-- Setup of Default path & Parameters************************* -->
					<div id="titel_setup_content">
						<div class="TOOLBAR-TITEL" id="setupOfMarelab">
						 	<script>changeText('setupOfMarelab');</script>
						</div>
						<div id="TOOLBAR">
							<input type="image" onclick="SAVE_MARELABSETUPDATA();" src="img/savef.png" width="32" height="32" alt="save marelab config" />
							<input type="image" onclick="GET_MARELABSETUPDATA();" src="img/REFRESH.png" width="32" height="32" alt="refresh config" />
							<!-- <button id="BUTTON_SCAN_PLUGIN" onclick="GET_PLUGININFO()">refresh</button> -->
						</div>
					</div>
					<div id="container">
						<!-- START OF PLUGIN SCAN -->
						<!-- ************************* -->
						<div id="LINKS">
							<!-- FILL -->
						</div>
						<div id="RECHTS">
							<div id="DONTCHANGE_SETUP">
								<script>changeText('DONTCHANGE_SETUP');</script>
							</div>
							<div id="listOfMarelabConfigVars">
								<!-- LIST OF MARELAB CONFIG VARS -->
								<!-- ************************* -->
							</div>
						</div>
					</div>
					
					<!-- **************   END SETUP CONTENT ********************* -->

				</div>
				<!-- </div> CONTAINER-RIGHT -->
			</div>
		</div>
	</div>
	<div id="footer">
		<div id="TOOLBAR-TITEL">
			<p id="deamonVersion">Version:</p>
			<a href="http://www.marelab.org">open source reef control
				www.marelab.org</a>
		</div>
		<div id="TOOLBAR"></div>
	</div>

	<div id="dialoglog" title="marelab deamon Log">
		<p id="loginfo"></p>
	</div>
	<!-- Dialog for the Adapter Seclection -->
	<div id="AdapterDialog" style="display: none" title="Adapter Selction">
		<p id="AdapterSelection"></p>
	</div>
	
	<!-- Dialog for the Adapter Configuration -->
	<div id="AdapterConfig" style="display: none" title="Adapter Configuration">
		<p id="AdapterConfigContent"></p>
	</div>
	
	
	<!-- 
		Dialog for the Connector Configuration 
		This is a universal Dialog for all logic 
		Plugins. 
	-->
	
	<div id="ConnectorConfig" style="display: none" title="Connector Configuration">
		<p id="ConnectorConfigContent"></p>
	</div>
	
  <div id="TestList"></div>
 
</body>
</html>

